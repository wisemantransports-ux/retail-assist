ROLE You are a senior full-stack SaaS engineer with deep experience in:

Meta (Facebook & Instagram) Graph API

OAuth flows

Multi-tenant SaaS onboarding

Production-ready automation platforms


You MUST NOT redesign the app, change pricing, or rebuild existing features.


---

üéØ GOAL (VERY IMPORTANT)

We already have a Retail Assist App built on Next.js and Replit Database.

Your task is to finish the missing Meta integration so that:

1. ONLY ONE Meta App (owned by admin) is verified


2. Clients DO NOT need Meta verification


3. Clients simply:

Sign up

Login

Click ‚ÄúConnect Facebook Page‚Äù

Select their page

Bot starts working




This is the exact model used by tools like ManyChat, Chatfuel, etc.


---

üö´ WHAT YOU MUST NOT DO

‚ùå Do NOT remove WhatsApp / Facebook / Instagram features

‚ùå Do NOT rebuild dashboards or UI already done

‚ùå Do NOT introduce Supabase, Netlify, or new databases

‚ùå Do NOT change pricing ($22 / $45 / $75)

‚ùå Do NOT replace Replit DB

‚ùå Do NOT change authentication logic


You must extend, not replace.


---

‚úÖ WHAT YOU MUST IMPLEMENT (STEP BY STEP)

1Ô∏è‚É£ Single Meta App Architecture (Admin-Owned)

Use ONE Meta App:

App is verified ONCE by admin

App ID & Secret stored in environment variables


All client pages connect through this app


Env vars required:

META_APP_ID
META_APP_SECRET
META_VERIFY_TOKEN


---

2Ô∏è‚É£ Client Facebook Page Connection Flow (CRITICAL)

Implement OAuth flow:

Client Flow

1. Client logs into dashboard


2. Clicks Connect Facebook Page


3. Redirect to Meta OAuth:

scopes:

pages_manage_metadata

pages_read_engagement

pages_messaging

instagram_manage_messages

instagram_basic




4. After auth:

Fetch list of pages client manages

Let client select page(s)



5. Store:

page_id

page_name

page_access_token

connected_at

user_id




üìå Store all data in Replit Database (JSON or structured)


---

3Ô∏è‚É£ NO Client Verification Required

Clients should NOT:

Create Meta apps

Submit Meta verification

Touch Meta Developer Console



All requests go through admin-verified Meta App


---

4Ô∏è‚É£ Webhook Activation (Already Exists ‚Äì Finish It)

Use existing endpoints:

/api/webhooks/facebook

/api/webhooks/instagram



You must:

Complete webhook verification handshake

Ensure events are processed:

Comments

Messages


Map incoming events ‚Üí correct client ‚Üí correct page



---

5Ô∏è‚É£ Comment-to-DM Automation (CORE FEATURE)

When:

Someone comments on a connected page post


Then:

Detect comment

Generate AI response using client‚Äôs AI agent prompt

Send private DM via Messenger API

Respect plan limits:

Starter: limited pages & messages

Pro: more pages

Enterprise: unlimited




---

6Ô∏è‚É£ AI Agent Usage

Use existing OpenAI integration

Each business uses its own:

system prompt

greeting

fallback


Do NOT change AI logic, only connect it properly



---

7Ô∏è‚É£ Admin Control (Already Exists ‚Äì Wire It)

Ensure:

Admin can:

Activate / suspend users

Override subscriptions manually


Suspended users:

Cannot connect pages

Cannot send messages




---

8Ô∏è‚É£ Fix Remaining Supabase References

Remove or safely disable unused Supabase imports

Do NOT refactor entire app

Only fix breaking imports



---

üß™ DELIVERABLES

By the end:

A client can:

Signup

Login

Connect Facebook Page

Receive & auto-reply to comments via DM


Admin:

Uses ONE Meta App

Controls all clients from dashboard


App runs fully on Replit

Production-ready



---

‚ö† FINAL INSTRUCTION

Before coding:

1. Scan the project


2. Identify exact files to modify


3. Implement only missing pieces


4. Do NOT start from scratch



If anything is unclear, ASK before coding.