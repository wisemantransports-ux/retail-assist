[build]
  command = "npm ci && npm run build"
  publish = ".next"  # Set the publish directory to ".next" (default Next.js build folder)

[[plugins]]
  package = "@netlify/plugin-nextjs"

[build.environment]
  SECRETS_SCAN_OMIT_KEYS = "NEXT_PUBLIC_SUPABASE_URL,NEXT_PUBLIC_SUPABASE_ANON_KEY,SUPABASE_SERVICE_ROLE_KEY,META_PAGE_ACCESS_TOKEN,NEXT_PUBLIC_USE_MOCK_SUPABASE"

[context.production.environment]
  NEXT_PUBLIC_USE_MOCK_SUPABASE = "false"
  # NOTE: Production environment variables should be set in the Netlify UI.
  # To go-live, set NEXT_PUBLIC_USE_MOCK_SUPABASE = "false" in the Netlify environment and add Supabase keys.
  # Add other production variables in Netlify UI
  # OPENAI_API_KEY = "sk-..."
  # META_PAGE_ACCESS_TOKEN = "..."

[context.deploy-preview.environment]
  # Deploy previews use mock mode by default
  NEXT_PUBLIC_USE_MOCK_SUPABASE = "true"
  NEXT_PUBLIC_TEST_MODE = "false"

[context.branch-deploy.environment]
  # Branch deploys use mock mode by default
  NEXT_PUBLIC_USE_MOCK_SUPABASE = "true"
  NEXT_PUBLIC_TEST_MODE = "false"
